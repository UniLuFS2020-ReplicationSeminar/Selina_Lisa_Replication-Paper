---
title: "Replication Report - The ideological nationalization of partisan subconstituencies in the American States (2018) by Devin Caughey · James Dunham · Christopher Warshaw"
author: "Selina Nguyen, Lisa Thai"
date: "5/26/2020"
output: 
  html_document: 
    toc: yes
    number_sections: yes
---

# The ideological nationalization of partisan subconstituencies in the American States (2018)

## Introduction 
The paper "The ideological nationalization of partisan subconstituencies in the American States" (2018) by Caughey et al. enables to question and to re-consider previous knwoledge about the ideological polarization among the Congress members and the among the population. Before, there was a consensus that the accelarating and increasing polarization between Democrats and Republicans prevails among Congress members. Mass polarization among citizens were not measureable and therefore considered to be low and rather stable. Caughey et al. made a great contribution by showing that polarization among citizens existists and is increasing too. This was possible by using estimated scores about the ideological position of the average Democrats and Republicans using survey-data that covers attitudes about economic, racial, and social policy aggregated for each state.

## Transparency

## Description of the data

The actual tables and figures that were assigned to be replicated, accompanied by a short comparison with the corresponding tables and figures published in the paper. Relevant questions to be tackled in the report include: are the main findings successfully replicated? Were there hidden assumptions in the paper that influenced the results in a way that could not be perceived by the normal reader? Were there coding errors or any other factual mistake? A conclusion with an overall assessment of the replication exercise is also expected.

## Replication Work
In this following section we will describe our replication process, as well as explain the code we used to create the figure depicting the senate ideal points.

### Intial Setup
We started by downloading and selecting the necessary packages, such as dplyr and ggplot2. Differently from the original syntax, we left out the data.table, haven and readr package.
```{r setup, eval=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Download packages
library(tidyverse)
library(dplyr)
library(readr) #?
library(knitr) #?
```

After setting the working directory, following the original syntax, we loaded three datasets into R, while also renaming them according to the issue domains _Economic_, _Social_ and _Racial_. This resulted also into an unnecessary dataframe called _table_, which we removed for clarity's sake.
```{r load data, eval=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Set working directory
here::here()

# Load and rename datasets according to issue domains
Economic <- get(load(here::here("Data","senate-econ.RData")))
Social <- get(load(here::here("Data","senate-social.RData")))
Racial <- get(load(here::here("Data","senate-race.RData")))
remove(table)
```

Then, we proceeded to merge the datasets into a single one, which we named _ideals_. As we still wanted to be able to identify from which issue domain the values came from, we added a column called _domain_.
```{r merge data, eval=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Merge datasets into one, but specify which domain the values belong to
ideals <- bind_rows(list(Economic = Economic, Social = Social, Racial = Racial), .id = "domain")
```


### Optimizing the dataset
After the initial setup, we continued by optimizing our dataset _ideals_ to create the graph, starting with filtering out roll call data in the racial and social domains that preceeded the 85th Congress. For all issue domains, including the economic one, we filtered out values that went beyond the 113th Congress.
The reason behind this specific filtering lies in the paper: "For the economic domain, we estimate senators’ ideal points in each congressional term between the 81th (1949–1950) and 113th (2013–2013). Because few roll call on social and race issues were voted on until the late 1950s, our estimates for these domains start in the 85th Congress (1957–1958)" (Caughey et al. 2018, 137).
Without thoroughly reading and comprehending the paper, we would not have figured out this essential step in the original syntax as it was not commented on.
```{r filter data}
knitr::opts_chunk$set(echo = TRUE)

# Filter out data after 113th Congress in all domains
# Filter out data before 85th Congress in racial and social domains 
ideals <- filter(ideals, congress <= 113,
                 !(domain == "Racial" & congress < 85),
                 !(domain == "Social" & congress < 85))
```

Next, we standardized the scores of the ideal points and named the new variable _dynamic_ideal_norm_. Here, not only did the authors describe the code, the normalization also matched what was described in the paper. The estimates of the ideal points were to be coded as to produce a mean of 0 and variance of 1 across senator-congresses (Caughey et al. 2018, 137).
To make sure we were on the right track, we tested our z-standardization by taking the mean and the standard deviation of the ideal points.
```{r normalization and graphs}
knitr::opts_chunk$set(echo = TRUE)

# Normalize the scores
ideals <- ideals %>% 
  group_by(domain) %>% 
  mutate(dynamic_ideal_norm = (dynamic_ideal - mean(dynamic_ideal, na.rm = T)) / sd(dynamic_ideal, na.rm = T))

# Check standardization
mean(ideals$dynamic_ideal_norm) # ~0
sd(ideals$dynamic_ideal_norm) # 1
```

Indicated by a comment in the original syntax, though, not in the paper, there are also presidential senators, who are identified with the state abbreviation _USA_, included in the roll call data. Thus, we also filtered them out. 
```{r filtering out presidents}
# Drop presidents
ideals <- filter(ideals, !(state_abbrev == "USA"))
```


###Creating the graphs
After having reworked the dataframe, the Caughey et al. produce a first graph. However, as they comment in the syntax, this is not the final output, but to check the polarity.

From the original code, we had to deduce several steps First, they took the mean from the standardized ideal points and called the new variable _mean_ideal_. Then, they encoded the vector variable _party_code_ as a factor, presumably since the party code is a categorical variable and, therefore, has no numerical value.

It is explained neither in the paper, nor in the original syntax, that the dataset includes not only Republicans and Democrats, but also Conservatives and Independents. As the paper only focuses on polarization between Republican and Democratic senators, the other party members will need to be filtered out. After consulting the voteview website and looking at our data, we were able to figure out that the party codes for Republicans and Democrats were 100 and 200, respectively, while Conservatives were identified by 212 and Independents by 328.

We plotted our graph accordingly and were able to see the polarization of the senator's ideal points based on the issue domains. However, it is not clear to us why Caughey et al. had to check for polarity if the final graph was supposed to show exactly the polarization in Congress anyway.
```{r check polarity and test graph}
# Create a variable that is the mean of the ideal points
party_means <- ideals %>%
  group_by(domain, party_code, congress) %>% 
  mutate(mean_ideal = mean(dynamic_ideal_norm))

# Change party code variable into a factor
party_means <- party_means %>% 
  mutate(party_code = factor(party_code))

# Plot to check for polarity
# Only include Democrats and Republicans (e.g. party codes 100 and 200)
p1 <- ggplot(subset(party_means, party_code %in% c(100, 200))) +
  geom_line(mapping = aes(x = congress, y = mean_ideal, color = party_code)) +
  facet_wrap(~ domain)

p1
```


The ideal point estimates are coded so that larger scores are conservative and are standardized to have zero mean and unit variance across senator-con- gresses. Finally, for each term, we calculated the ideal-point differences between senators from the same state but different parties, and then we averaged the domain-specifc differences within each term.
```{r filtering and final graph}
# Filter out the Conservative and Independent party members
ideals <- filter(ideals, !(party_code == 212), !(party_code == 328))

# Filter out the states that are represented by senators of only one party
ideals <- ideals %>% 
  group_by(congress, state_abbrev) %>% 
  mutate(two_party = length(unique(party_code)) > 1)

# Keep the states represented by both parties
ideals <- ideals %>% 
  filter(!(two_party == F))

# Take the within-state-party average, for the case in which there's more than
# one senator/member in a state-congress pair.    
ideals <- ideals %>% 
  group_by(congress, state_abbrev, party_code) %>% 
  mutate(dynamic_ideal_norm = mean(dynamic_ideal_norm))


# Take the within-state differences between parties in each congress
mean_state_diff <- function(ideal_points, time_var = "congress") {
  ideals = copy(ideal_points)
  setDT(ideals, key = c("congress", "state_abbrev", "party_code"))
  diffs <- ideals %>% 
    group_by(congress, state_abbrev) %>% 
    mutate(party_code = first(party_code),
           diff_score = dynamic_ideal[1] - dynamic_ideal[2], n = .N)
  mean_diffs <- diffs %>% 
    group_by(congress) %>% 
    mutate(mean_diff_score = mean(diff_score, na.rm = T), n = .N)
  mean_diffs
}
    
here::here()
mean_diff_by_domain = function(ideals) {
  .ideals = copy(ideals)
  econ_diff <- mean_state_diff(filter(.ideals, domain == "Economic"))
  race_diff <- mean_state_diff(filter(.ideals, domain == "Racial"))
  social_diff <- mean_state_diff(filter(.ideals, domain == "Social"))
  
  diffs = rbindlist(list("Economic" = econ_diff,
                         "Racial" = race_diff,
                         "Social" = social_diff),
                    idcol = "Domain", fill = T)
  
  congresses <- readRDS(here::here("Data", "congresses.Rds"))
  merge(diffs, congresses, by.x = "congress", by.y = "cong", all.x = T, all.y = F)
}

mean_diffs <- mean_diff_by_domain(ideals)


# Flip for same polarity as previous estimates
mean_diffs <- mean_diffs %>% 
  mutate(mean_diff_score = mean_diff_score * -1)


p2 <- ggplot(data = mean_diffs) +
  geom_line(mapping = aes(end_year, mean_diff_score, color = Domain, linetype = Domain)) +
  scale_linetype_manual(values=c("solid", "dashed", "dotdash")) +
  scale_y_continuous("Avg. Difference", limits = c(-.2, 2.6)) +
  scale_x_continuous("Year", limits = c(1945, 2017), breaks = seq(1950, 2010, 10)) +
  ggtitle("Senate Ideal Points") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))

p2
```

