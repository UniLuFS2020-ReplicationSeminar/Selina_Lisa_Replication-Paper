---
title: "Replication Report - The ideological nationalization of partisan subconstituencies in the American States (2018) by Devin Caughey · James Dunham · Christopher Warshaw"
author: "Selina Nguyen, Lisa Thai"
date: "5/26/2020"
output: 
  html_document: 
    toc: yes
    number_sections: yes
---

# The ideological nationalization of partisan subconstituencies in the American States (2018)

## Introduction 
The paper "The ideological nationalization of partisan subconstituencies in the American States" (2018) by Caughey et al. enables to question and to re-consider previous knwoledge about the ideological polarization among the Congress members and the among the population. Before, there was a consensus that the accelarating and increasing polarization between Democrats and Republicans prevails among Congress members. Mass polarization among citizens were not measureable and therefore considered to be low and rather stable. Caughey et al. made a great contribution by showing that polarization among citizens existists and is increasing too. This was possible by using estimated scores about the ideological position of the average Democrats and Republicans using survey-data that covers attitudes about economic, racial, and social policy aggregated for each state.

## Transparency

## Description of the data

The actual tables and figures that were assigned to be replicated, accompanied by a short comparison with the corresponding tables and figures published in the paper. Relevant questions to be tackled in the report include: are the main findings successfully replicated? Were there hidden assumptions in the paper that influenced the results in a way that could not be perceived by the normal reader? Were there coding errors or any other factual mistake? A conclusion with an overall assessment of the replication exercise is also expected.

## Replication Work
In this following section we will describe our replication process, as well as explain the code we used to create the figure depicting the senate ideal points.

### Intial Setup
We started by downloading and selecting the tidyverse package, as we required both dplyr and ggplot2. Differently from the original syntax, we left out the data.table, haven and readr package.
```{r setup, eval=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(readr) #?
library(knitr) #?
```

After setting the working directory, following the original syntax, we loaded three datasets into R, while also renaming them according to the issue domains _Economic_, _Social_ and _Racial_. This resulted also into an unnecessary dataframe called _table_, which we removed for clarity's sake.
```{r load data, eval=FALSE}
knitr::opts_chunk$set(echo = TRUE)
here::here()

Economic <- get(load(here::here("Data","senate-econ.RData")))
Social <- get(load(here::here("Data","senate-social.RData")))
Racial <- get(load(here::here("Data","senate-race.RData")))
remove(table)
```

Then, we proceeded to merge the datasets into a single one, which we named _ideals_. As we still wanted to be able to identify from which issue domain the values came from, we added a column called _domain_.
```{r merge data, eval=FALSE}
knitr::opts_chunk$set(echo = TRUE)
ideals <- bind_rows(list(Economic = Economic, Social = Social, Racial = Racial), .id = "domain")
```
    

#filtering out the dataset to acquire only data from the 85th for the racial and social domain, and to the 113th Congress for all domains (p.137)
```{r filter data}
knitr::opts_chunk$set(echo = TRUE)
              
ideals <- filter(ideals, congress <= 133,
                 !(domain == "Racial" & congress < 85),
                 !(domain == "Social" & congress < 85))
```

# Normalize scores (using Z-score: Z = (x-mean)/sd)
```{r normalization and graphs}
knitr::opts_chunk$set(echo = TRUE)
ideals <- ideals %>% 
  group_by(domain) %>% 
  mutate(dynamic_ideal_norm = (dynamic_ideal - mean(dynamic_ideal, na.rm = T)) / sd(dynamic_ideal, na.rm = T))

# check if it worked
mean(ideals$dynamic_ideal_norm) # ~0
sd(ideals$dynamic_ideal_norm) # 1

# Drop presidents
ideals <- filter(ideals, !(state_abbrev == "USA"))

# Check polarity
ideals <- ideals %>% 
  mutate(party_code = factor(party_code))

party_means <- ideals %>%
  group_by(domain, party_code, congress) %>% 
  mutate(mean_ideal = mean(dynamic_ideal_norm))

#     party codes: 100 for Democrats, 200 for Republicans, 212 for Conservatives, 328 for Independent
p1 <- ggplot(subset(party_means, party_code %in% c(100, 200))) +
  geom_line(mapping = aes(x = congress, y = mean_ideal, color = party_code)) +
  facet_wrap(~ domain)

p1

#filter out the Conservative and Independent party members
ideals <- filter(ideals, !(party_code == 212), !(party_code == 328))

#filter out the states that are represented by senators of only one party
ideals <- ideals %>% 
  group_by(congress, state_abbrev) %>% 
  mutate(two_party = length(unique(party_code)) > 1)

#keep the states represented by both parties
ideals <- ideals %>% 
  filter(!(two_party == F))

#Take the within-state-party average, for the case in which there's more than
# one senator/member in a state-congress pair.    
ideals <- ideals %>% 
  group_by(congress, state_abbrev, party_code) %>% 
  mutate(dynamic_ideal_norm = mean(dynamic_ideal_norm))


# Take the within-state differences between parties in each congress
mean_state_diff <- function(ideal_points, time_var = "congress") {
  ideals = copy(ideal_points)
  setDT(ideals, key = c("congress", "state_abbrev", "party_code"))
  diffs <- ideals %>% 
    group_by(congress, state_abbrev) %>% 
    mutate(party_code = first(party_code),
           diff_score = dynamic_ideal[1] - dynamic_ideal[2], n = .N)
  mean_diffs <- diffs %>% 
    group_by(congress) %>% 
    mutate(mean_diff_score = mean(diff_score, na.rm = T), n = .N)
  mean_diffs
}
    
here::here()
mean_diff_by_domain = function(ideals) {
  .ideals = copy(ideals)
  econ_diff <- mean_state_diff(filter(.ideals, domain == "Economic"))
  race_diff <- mean_state_diff(filter(.ideals, domain == "Racial"))
  social_diff <- mean_state_diff(filter(.ideals, domain == "Social"))
  
  diffs = rbindlist(list("Economic" = econ_diff,
                         "Racial" = race_diff,
                         "Social" = social_diff),
                    idcol = "Domain", fill = T)
  
  congresses <- readRDS(here::here("Data", "congresses.Rds"))
  merge(diffs, congresses, by.x = "congress", by.y = "cong", all.x = T, all.y = F)
}

mean_diffs <- mean_diff_by_domain(ideals)


# Flip for same polarity as previous estimates
mean_diffs <- mean_diffs %>% 
  mutate(mean_diff_score = mean_diff_score * -1)


p2 <- ggplot(data = mean_diffs) +
  geom_line(mapping = aes(end_year, mean_diff_score, color = Domain, linetype = Domain)) +
  scale_linetype_manual(values=c("solid", "dashed", "dotdash")) +
  scale_y_continuous("Avg. Difference", limits = c(-.2, 2.6)) +
  scale_x_continuous("Year", limits = c(1945, 2017), breaks = seq(1950, 2010, 10)) +
  ggtitle("Senate Ideal Points") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))

p2
  
```

